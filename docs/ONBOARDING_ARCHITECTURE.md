# Hyperclaw Onboarding & Skills Architecture

> Design document for immediate user onboarding, skills catalog, and first trade guidance.
> Supports both template-based (Railway) and skill.md-based (Telegram) onboarding paths.

---

## Table of Contents

1. [Overview](#overview)
2. [System Architecture](#system-architecture)
3. [State Management](#state-management)
4. [Onboarding Paths](#onboarding-paths)
5. [Skills Catalog](#skills-catalog)
6. [First Trade Guidance](#first-trade-guidance)
7. [Balance Monitoring](#balance-monitoring)
8. [Error Handling & Recovery](#error-handling--recovery)
9. [File Structure](#file-structure)
10. [Railway Deployment](#railway-deployment)
11. [Agent System Prompt](#agent-system-prompt)

---

## Overview

### Goals

1. **Immediate onboarding** â€” Detect new users and guide them through account creation before any other action
2. **Skills awareness** â€” After onboarding, show available skills and guide installation
3. **First trade guidance** â€” Walk users through their first trade end-to-end
4. **Dual path support** â€” Work for both template deploys (Railway) and skill.md uploads (Telegram)

### Design Principles

- **Zero-friction start** â€” User starts chatting, agent handles setup automatically
- **Fail-safe state** â€” Partial failures recoverable; state persisted and resumable
- **Progressive disclosure** â€” Show only what's needed at each step
- **Guided experience** â€” Don't just enable trading, teach users how to trade

---

## File Paths Summary

| Purpose | Path |
|---------|------|
| Senpi credentials | `$SENPI_STATE_DIR/credentials.json` |
| Onboarding state | `$SENPI_STATE_DIR/state.json` |
| Generated wallet | `$SENPI_STATE_DIR/wallet.json` |
| Installed skills | `$SENPI_STATE_DIR/skills/{skill-id}/` |
| Skills manifest cache | `$SENPI_STATE_DIR/skills/_manifest.json` |
| MCP server config | `$OPENCLAW_WORKSPACE_DIR/config/mcporter.json` |
| Agent workspace | `$OPENCLAW_WORKSPACE_DIR/` |

SENPI_STATE_DIR defaults to `$HOME/.senpi`.

---

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              HYPERCLAW AGENT                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                         MESSAGE HANDLER                                 â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚   User Message â”€â”€â–¶ [State Check] â”€â”€â–¶ [Route]                           â”‚ â”‚
â”‚  â”‚                          â”‚              â”‚                               â”‚ â”‚
â”‚  â”‚                          â–¼              â”œâ”€â”€â–¶ Onboarding Flow            â”‚ â”‚
â”‚  â”‚                    state.json           â”œâ”€â”€â–¶ Funding Reminder           â”‚ â”‚
â”‚  â”‚                                         â”œâ”€â”€â–¶ First Trade Guide          â”‚ â”‚
â”‚  â”‚                                         â””â”€â”€â–¶ Normal Processing          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   ONBOARDING    â”‚  â”‚     SKILLS      â”‚  â”‚   FIRST TRADE   â”‚  â”‚BALANCE â”‚ â”‚
â”‚  â”‚     MODULE      â”‚  â”‚     MODULE      â”‚  â”‚     GUIDE       â”‚  â”‚MONITOR â”‚ â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚        â”‚ â”‚
â”‚  â”‚ â€¢ Detect path   â”‚  â”‚ â€¢ Fetch manifestâ”‚  â”‚ â€¢ Discovery     â”‚  â”‚â€¢ Check â”‚ â”‚
â”‚  â”‚ â€¢ Identity      â”‚  â”‚ â€¢ Show catalog  â”‚  â”‚ â€¢ Position open â”‚  â”‚â€¢ Remindâ”‚ â”‚
â”‚  â”‚ â€¢ API register  â”‚  â”‚ â€¢ Install skill â”‚  â”‚ â€¢ DSL setup     â”‚  â”‚â€¢ Updateâ”‚ â”‚
â”‚  â”‚ â€¢ Credentials   â”‚  â”‚ â€¢ Dependencies  â”‚  â”‚ â€¢ Position closeâ”‚  â”‚        â”‚ â”‚
â”‚  â”‚ â€¢ MCP config    â”‚  â”‚                 â”‚  â”‚ â€¢ Celebrate     â”‚  â”‚        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                         PERSISTENT STORAGE                              â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚  $SENPI_STATE_DIR/                     $OPENCLAW_WORKSPACE_DIR/         â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ credentials.json                  â”œâ”€â”€ config/                      â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ wallet.json                       â”‚   â””â”€â”€ mcporter.json            â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ state.json                        â””â”€â”€ ...                          â”‚ â”‚
â”‚  â”‚  â””â”€â”€ skills/                                                            â”‚ â”‚
â”‚  â”‚      â”œâ”€â”€ _manifest.json                                                 â”‚ â”‚
â”‚  â”‚      â””â”€â”€ {skill-id}/                                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                         EXTERNAL SERVICES                               â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚  Senpi API â—€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Account creation, balance checks                 â”‚ â”‚
â”‚  â”‚  Senpi MCP â—€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Trading tools (47 tools)                         â”‚ â”‚
â”‚  â”‚  GitHub    â—€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Skills manifest & SKILL.md files                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## State Management

### State Machine

```
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   FAILED    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                     â”‚             â”‚                     â”‚
              â”‚                     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                     â”‚
              â”‚                            â”‚                            â”‚
              â”‚                            â”‚ (retry)                    â”‚
              â”‚                            â–¼                            â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
       â”‚             â”‚           â”‚             â”‚           â”‚                   â”‚
       â”‚    FRESH    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  ONBOARDING â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚     UNFUNDED      â”‚
       â”‚  (no state) â”‚           â”‚             â”‚           â”‚                   â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                     â”‚
                                                                     â”‚ (balance > 0)
                                                                     â–¼
                                                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                           â”‚                     â”‚
                                                           â”‚   AWAITING_FIRST    â”‚
                                                           â”‚       TRADE         â”‚
                                                           â”‚                     â”‚
                                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                      â”‚
                                                                      â”‚ (first trade complete)
                                                                      â–¼
                                                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                           â”‚                     â”‚
                                                           â”‚       READY         â”‚
                                                           â”‚                     â”‚
                                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### State Definitions

| State | Description | Agent Behavior |
|-------|-------------|----------------|
| `FRESH` | No `state.json` exists | Intercept all messages â†’ Detect path â†’ Start onboarding |
| `ONBOARDING` | Onboarding in progress | Continue onboarding flow from last step |
| `UNFUNDED` | Account created, wallet empty | Remind to fund; allow skill browsing |
| `AWAITING_FIRST_TRADE` | Funded but no trades yet | Guide through first trade tutorial |
| `READY` | First trade complete, fully operational | Process all requests normally |
| `FAILED` | Error occurred | Show error, offer retry or manual fallback |

### State File Schema

**Location:** `$SENPI_STATE_DIR/state.json`

```json
{
  "version": "1.0.0",
  "state": "READY",
  "error": null,
  
  "onboardingPath": "TEMPLATE | SKILL_MD",
  
  "onboarding": {
    "step": "IDENTITY | API_CALL | CREDENTIALS | MCP_CONFIG | COMPLETE",
    "startedAt": "2025-02-26T10:00:00Z",
    "completedAt": "2025-02-26T10:02:00Z",
    "identityType": "TELEGRAM | WALLET",
    "subject": "myusername",
    "walletGenerated": false,
    "referralCodeUsed": "ABC123",
    "existingAccount": false
  },
  
  "account": {
    "userId": "user_xxx",
    "referralCode": "XYZ789",
    "agentWalletAddress": "0x..."
  },
  
  "wallet": {
    "address": "0x...",
    "funded": true,
    "lastBalanceCheck": "2025-02-26T12:00:00Z",
    "balanceUsd": 1500.00
  },
  
  "firstTrade": {
    "started": true,
    "step": "DISCOVERY | SKILL_INSTALL | POSITION_OPEN | DSL_SETUP | POSITION_CLOSE | COMPLETE",
    "startedAt": "2025-02-26T11:00:00Z",
    "completedAt": "2025-02-26T11:30:00Z",
    "tradeDetails": {
      "asset": "ETH",
      "direction": "LONG",
      "entryPrice": 3200.00,
      "exitPrice": 3250.00,
      "pnl": 15.60,
      "strategyId": "strat_xxx"
    },
    "skillInstalled": "dsl-dynamic-stop-loss",
    "skipped": false
  },
  
  "skills": {
    "installed": ["dsl-dynamic-stop-loss"],
    "manifestVersion": "1.0.0",
    "lastManifestFetch": "2025-02-26T10:00:00Z"
  },
  
  "mcp": {
    "configured": true,
    "endpoint": "https://mcp.prod.senpi.ai/mcp"
  }
}
```

---

## Onboarding Paths

The agent supports two distinct onboarding paths based on how the user arrives:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           PATH DETECTION                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  On first message, detect which path:                                        â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚      PATH A: TEMPLATE       â”‚     â”‚      PATH B: SKILL.MD       â”‚        â”‚
â”‚  â”‚         (Railway)           â”‚     â”‚        (Telegram)           â”‚        â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚
â”‚  â”‚                             â”‚     â”‚                             â”‚        â”‚
â”‚  â”‚ Detection:                  â”‚     â”‚ Detection:                  â”‚        â”‚
â”‚  â”‚ â€¢ No credentials exist      â”‚     â”‚ â€¢ User sends SKILL.md file  â”‚        â”‚
â”‚  â”‚ â€¢ Running in container env  â”‚     â”‚ â€¢ OR says "setup senpi"     â”‚        â”‚
â”‚  â”‚ â€¢ HYPERCLAW_TEMPLATE=true   â”‚     â”‚ â€¢ May have existing account â”‚        â”‚
â”‚  â”‚                             â”‚     â”‚                             â”‚        â”‚
â”‚  â”‚ Flow:                       â”‚     â”‚ Flow:                       â”‚        â”‚
â”‚  â”‚ 1. Full onboarding          â”‚     â”‚ 1. Check existing account   â”‚        â”‚
â”‚  â”‚ 2. Create new account       â”‚     â”‚ 2. Link or create account   â”‚        â”‚
â”‚  â”‚ 3. Configure MCP            â”‚     â”‚ 3. Configure MCP            â”‚        â”‚
â”‚  â”‚ 4. Show skills              â”‚     â”‚ 4. Show skills              â”‚        â”‚
â”‚  â”‚ 5. First trade guide        â”‚     â”‚ 5. First trade guide        â”‚        â”‚
â”‚  â”‚                             â”‚     â”‚                             â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Path A: Template-Based (Railway)

For users who deploy from the Hyperclaw template on Railway.

#### Trigger

- No `$SENPI_STATE_DIR/credentials.json` exists
- Environment variable `HYPERCLAW_TEMPLATE=true` (set by Railway template)

#### Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP A1: WELCOME & COLLECT IDENTITY                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚ Agent displays:                                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ðŸ‘‹ Welcome to Senpi! I'm your AI trading agent for Hyperliquid.         â”‚ â”‚
â”‚ â”‚                                                                          â”‚ â”‚
â”‚ â”‚ Let's get you set up â€” this takes about 2 minutes.                      â”‚ â”‚
â”‚ â”‚                                                                          â”‚ â”‚
â”‚ â”‚ How would you like to create your account?                              â”‚ â”‚
â”‚ â”‚                                                                          â”‚ â”‚
â”‚ â”‚ 1ï¸âƒ£  Telegram (recommended) â€” Link your @username                        â”‚ â”‚
â”‚ â”‚ 2ï¸âƒ£  Wallet â€” Use an existing Ethereum address                           â”‚ â”‚
â”‚ â”‚ 3ï¸âƒ£  Generate new wallet â€” I'll create one for you                       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚ State: { state: "ONBOARDING", onboardingPath: "TEMPLATE",                   â”‚
â”‚          onboarding.step: "IDENTITY" }                                      â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP A2: CALL SENPI API                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚ If Option 3 (generate wallet):                                               â”‚
â”‚   â€¢ Generate EVM wallet using ethers.js                                      â”‚
â”‚   â€¢ Save to $SENPI_STATE_DIR/wallet.json (chmod 600)                         â”‚
â”‚   â€¢ IDENTITY_TYPE=WALLET, IDENTITY_VALUE={generated address}                â”‚
â”‚                                                                              â”‚
â”‚ Execute CreateAgentStubAccount mutation:                                     â”‚
â”‚   POST https://moxie-backend.prod.senpi.ai/graphql                          â”‚
â”‚   { from: "{TYPE}", subject: "{VALUE}", referralCode: "{REF}" }             â”‚
â”‚                                                                              â”‚
â”‚ State: { onboarding.step: "API_CALL" }                                      â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP A3: SAVE CREDENTIALS                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚ Write $SENPI_STATE_DIR/credentials.json (chmod 600):                         â”‚
â”‚ {                                                                            â”‚
â”‚   "apiKey": "{from API}",                                                   â”‚
â”‚   "userId": "{from API}",                                                   â”‚
â”‚   "referralCode": "{user's code}",                                          â”‚
â”‚   "agentWalletAddress": "{from API}"                                        â”‚
â”‚ }                                                                            â”‚
â”‚                                                                              â”‚
â”‚ State: { onboarding.step: "CREDENTIALS" }                                   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP A4: CONFIGURE MCP SERVER                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚ mcporter config add senpi \                                                  â”‚
â”‚   --command npx \                                                            â”‚
â”‚   --persist $OPENCLAW_WORKSPACE_DIR/config/mcporter.json \                    â”‚
â”‚   --env SENPI_AUTH_TOKEN="{API_KEY}" \                                      â”‚
â”‚   -- mcp-remote "https://mcp.prod.senpi.ai/mcp" \                           â”‚
â”‚   --header "Authorization: Bearer ${SENPI_AUTH_TOKEN}"                      â”‚
â”‚                                                                              â”‚
â”‚ State: { onboarding.step: "MCP_CONFIG", mcp.configured: true }              â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP A5: COMPLETE â€” SHOW WALLET & SKILLS                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚ State: { state: "UNFUNDED", onboarding.step: "COMPLETE" }                   â”‚
â”‚                                                                              â”‚
â”‚ Agent displays:                                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ âœ… Your Senpi account is ready!                                         â”‚ â”‚
â”‚ â”‚                                                                          â”‚ â”‚
â”‚ â”‚ ðŸ’° NEXT STEP: Fund your wallet to start trading                         â”‚ â”‚
â”‚ â”‚    Address: 0x1234...5678                                               â”‚ â”‚
â”‚ â”‚    Chains: Base, Arbitrum, Optimism, Polygon, Ethereum                  â”‚ â”‚
â”‚ â”‚    Currency: USDC                                                        â”‚ â”‚
â”‚ â”‚                                                                          â”‚ â”‚
â”‚ â”‚ ðŸ”— Your referral link: senpi.ai/skill.md?ref=XYZ789                     â”‚ â”‚
â”‚ â”‚                                                                          â”‚ â”‚
â”‚ â”‚ While you fund your wallet, here are the skills you can install:        â”‚ â”‚
â”‚ â”‚                                                                          â”‚ â”‚
â”‚ â”‚ ðŸº WOLF Strategy â€” Autonomous trading ($500 min)                        â”‚ â”‚
â”‚ â”‚ ðŸ“Š Opportunity Scanner â€” Find setups ($100 min)                         â”‚ â”‚
â”‚ â”‚ ðŸ›¡ï¸ DSL â€” Trailing stop loss ($100 min)                                  â”‚ â”‚
â”‚ â”‚ ðŸ‹ Whale Index â€” Mirror top traders ($500 min)                          â”‚ â”‚
â”‚ â”‚                                                                          â”‚ â”‚
â”‚ â”‚ Say "show all skills" for the full list.                                â”‚ â”‚
â”‚ â”‚                                                                          â”‚ â”‚
â”‚ â”‚ Once funded, I'll walk you through your first trade! ðŸš€                 â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Path B: skill.md-Based (Telegram)

For users who receive the SKILL.md file and send it to their Telegram agent.

#### Trigger

- User sends a file attachment containing "senpi-onboard" SKILL.md content
- OR user says "setup senpi", "connect to senpi", "onboard to senpi"
- May already have Senpi account from mobile app

#### Key Differences from Path A

| Aspect | Path A (Template) | Path B (skill.md) |
|--------|-------------------|-------------------|
| Storage | Railway volume â†’ $SENPI_STATE_DIR | Local $HOME/.senpi |
| Existing account | Never (fresh deploy) | Possibly (from mobile app) |
| MCP config tool | mcporter | Varies by agent platform |
| Entry point | First message | File upload or keyword |

#### Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP B1: DETECT & CHECK EXISTING ACCOUNT                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚ User sends SKILL.md file or says "setup senpi"                              â”‚
â”‚                                                                              â”‚
â”‚ Agent checks:                                                                â”‚
â”‚ 1. Does $SENPI_STATE_DIR/credentials.json exist?                             â”‚
â”‚    â†’ YES: Skip to Step B4 (verify & show skills)                            â”‚
â”‚    â†’ NO: Continue to identity collection                                    â”‚
â”‚                                                                              â”‚
â”‚ Agent displays:                                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ðŸ‘‹ Let's connect your Senpi account!                                    â”‚ â”‚
â”‚ â”‚                                                                          â”‚ â”‚
â”‚ â”‚ Do you already have a Senpi account (from the mobile app)?              â”‚ â”‚
â”‚ â”‚                                                                          â”‚ â”‚
â”‚ â”‚ 1ï¸âƒ£  Yes, I have an account â€” I'll create an API key                     â”‚ â”‚
â”‚ â”‚ 2ï¸âƒ£  No, create a new account for me                                     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚ State: { state: "ONBOARDING", onboardingPath: "SKILL_MD",                   â”‚
â”‚          onboarding.step: "IDENTITY" }                                      â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚                               â”‚
                      â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP B2a: EXISTING ACCOUNT      â”‚   â”‚ STEP B2b: NEW ACCOUNT               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚   â”‚                                     â”‚
â”‚ Agent displays:                 â”‚   â”‚ Same as Path A Steps A1-A2:         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚ â€¢ Collect identity (Telegram/       â”‚
â”‚ â”‚ Great! Please create an API â”‚ â”‚   â”‚   Wallet/Generate)                  â”‚
â”‚ â”‚ key at senpi.ai/apikey:     â”‚ â”‚   â”‚ â€¢ Call CreateAgentStubAccount       â”‚
â”‚ â”‚                             â”‚ â”‚   â”‚                                     â”‚
â”‚ â”‚ 1. Login with your usual    â”‚ â”‚   â”‚ State: { onboarding.existingAccount:â”‚
â”‚ â”‚    method                   â”‚ â”‚   â”‚          false }                    â”‚
â”‚ â”‚ 2. Click "New Key"          â”‚ â”‚   â”‚                                     â”‚
â”‚ â”‚ 3. Name it (e.g., "Agent")  â”‚ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ â”‚ 4. Copy and paste it here   â”‚ â”‚
â”‚ â”‚                             â”‚ â”‚
â”‚ â”‚ âš ï¸ You won't see the key    â”‚ â”‚
â”‚ â”‚    again after creation!    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚
â”‚ User pastes API key             â”‚
â”‚                                 â”‚
â”‚ State: { onboarding.            â”‚
â”‚          existingAccount: true }â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP B3: SAVE CREDENTIALS & CONFIGURE MCP                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚ If new account: Save API response to credentials.json                       â”‚
â”‚ If existing: Save provided API key to credentials.json                      â”‚
â”‚                                                                              â”‚
â”‚ Detect agent platform and configure MCP:                                     â”‚
â”‚                                                                              â”‚
â”‚ â€¢ OpenClaw/Hyperclaw â†’ mcporter --persist $OPENCLAW_WORKSPACE_DIR/config/...  â”‚
â”‚ â€¢ Claude Code â†’ claude mcp add senpi ...                                    â”‚
â”‚ â€¢ Other â†’ Write to ~/.mcp.json or equivalent                                â”‚
â”‚                                                                              â”‚
â”‚ Fetch wallet address via user_get_me MCP tool (now that MCP is configured) â”‚
â”‚                                                                              â”‚
â”‚ State: { onboarding.step: "MCP_CONFIG", mcp.configured: true }              â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP B4: COMPLETE â€” VERIFY & SHOW SKILLS                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚ Call account_get_portfolio to verify connection and get balance             â”‚
â”‚                                                                              â”‚
â”‚ If balance > 0:                                                              â”‚
â”‚   State: { state: "AWAITING_FIRST_TRADE" }                                  â”‚
â”‚ Else:                                                                        â”‚
â”‚   State: { state: "UNFUNDED" }                                              â”‚
â”‚                                                                              â”‚
â”‚ Agent displays:                                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ âœ… Connected to Senpi!                                                  â”‚ â”‚
â”‚ â”‚                                                                          â”‚ â”‚
â”‚ â”‚ ðŸ’° Wallet: 0x1234...5678                                                â”‚ â”‚
â”‚ â”‚    Balance: $1,500.00 USDC  â† (or "Not funded yet" if $0)              â”‚ â”‚
â”‚ â”‚                                                                          â”‚ â”‚
â”‚ â”‚ ðŸ§  Available Skills:                                                    â”‚ â”‚
â”‚ â”‚    ðŸº WOLF â€¢ ðŸ“Š Scanner â€¢ ðŸ›¡ï¸ DSL â€¢ ðŸ‹ Whale Index â€¢ ...                â”‚ â”‚
â”‚ â”‚                                                                          â”‚ â”‚
â”‚ â”‚ [If funded] Ready for your first trade? Say "let's trade" to start!    â”‚ â”‚
â”‚ â”‚ [If not funded] Fund your wallet, then we'll make your first trade!    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Skills Catalog

### Manifest Structure

**Location:** `https://raw.githubusercontent.com/Senpi-ai/senpi-skills/main/manifest.json`

```json
{
  "version": "1.0.0",
  "updated": "2025-02-26T00:00:00Z",
  "baseUrl": "https://raw.githubusercontent.com/Senpi-ai/senpi-skills/main",
  "skills": [
    {
      "id": "wolf-strategy",
      "name": "WOLF Strategy",
      "emoji": "ðŸº",
      "description": "Fully autonomous 2-3 slot trading. +$2,100 proven in 24h.",
      "category": "autonomous",
      "minBudget": 500,
      "recommendedBudget": 1000,
      "difficulty": "intermediate",
      "requires": [],
      "files": ["SKILL.md", "scripts/", "references/"],
      "firstTradeRecommended": false
    },
    {
      "id": "dsl-dynamic-stop-loss",
      "name": "DSL (Dynamic Stop Loss)",
      "emoji": "ðŸ›¡ï¸",
      "description": "2-phase trailing stop loss with ROE-based tier triggers.",
      "category": "risk-management",
      "minBudget": 100,
      "difficulty": "beginner",
      "requires": [],
      "files": ["SKILL.md", "scripts/dsl.py"],
      "firstTradeRecommended": true
    },
    {
      "id": "opportunity-scanner",
      "name": "Opportunity Scanner",
      "emoji": "ðŸ“Š",
      "description": "4-stage funnel screening 500+ perps. Scores 0-400.",
      "category": "analysis",
      "minBudget": 100,
      "difficulty": "beginner",
      "requires": [],
      "files": ["SKILL.md", "scripts/scanner.py"],
      "firstTradeRecommended": true
    },
    {
      "id": "autonomous-trading",
      "name": "Autonomous Trading",
      "emoji": "ðŸ¤–",
      "description": "Give agent budget + target + deadline. It does the rest.",
      "category": "autonomous",
      "minBudget": 500,
      "recommendedBudget": 1000,
      "difficulty": "advanced",
      "requires": ["dsl-dynamic-stop-loss", "opportunity-scanner", "emerging-movers"],
      "files": ["SKILL.md"],
      "firstTradeRecommended": false
    },
    {
      "id": "emerging-movers",
      "name": "Emerging Movers Detector",
      "emoji": "ðŸš€",
      "description": "Tracks SM concentration across all Hyperliquid assets.",
      "category": "signals",
      "minBudget": 100,
      "difficulty": "beginner",
      "requires": [],
      "files": ["SKILL.md", "scripts/emerging_movers.py"],
      "firstTradeRecommended": false
    },
    {
      "id": "whale-index",
      "name": "Whale Index",
      "emoji": "ðŸ‹",
      "description": "Auto-mirror top Discovery traders by PnL and win rate.",
      "category": "copy-trading",
      "minBudget": 500,
      "difficulty": "beginner",
      "requires": [],
      "files": ["SKILL.md"],
      "firstTradeRecommended": false
    },
    {
      "id": "dsl-tight",
      "name": "DSL-Tight",
      "emoji": "ðŸ”’",
      "description": "Tighter DSL variant with aggressive profit protection.",
      "category": "risk-management",
      "minBudget": 100,
      "difficulty": "intermediate",
      "requires": [],
      "files": ["SKILL.md", "scripts/dsl_tight.py"],
      "firstTradeRecommended": false
    },
    {
      "id": "wolf-howl",
      "name": "HOWL",
      "emoji": "ðŸŒ™",
      "description": "Nightly self-improvement loop analyzing WOLF trades.",
      "category": "analysis",
      "minBudget": 0,
      "difficulty": "advanced",
      "requires": ["wolf-strategy"],
      "files": ["SKILL.md", "scripts/howl.py"],
      "firstTradeRecommended": false
    }
  ]
}
```

### Skill Installation

Skills are installed to `$SENPI_STATE_DIR/skills/{skill-id}/`:

```bash
# Example: Installing DSL
mkdir -p $SENPI_STATE_DIR/skills/dsl-dynamic-stop-loss/scripts
curl -sL {baseUrl}/dsl-dynamic-stop-loss/SKILL.md \
  -o $SENPI_STATE_DIR/skills/dsl-dynamic-stop-loss/SKILL.md
curl -sL {baseUrl}/dsl-dynamic-stop-loss/scripts/dsl.py \
  -o $SENPI_STATE_DIR/skills/dsl-dynamic-stop-loss/scripts/dsl.py
```

---

## First Trade Guidance

### Trigger

State transitions to `AWAITING_FIRST_TRADE` when:
- Onboarding complete AND wallet balance > 0 AND no trades recorded

### First Trade Steps

| Step | Action | MCP Tools Used |
|------|--------|----------------|
| 1. Introduction | Explain the trade cycle | â€” |
| 2. Discovery | Find opportunity | `discovery_get_top_traders` |
| 3. Install DSL | Add protection | â€” (skill install) |
| 4. Open Position | Enter trade | `create_position` |
| 5. Activate DSL | Start monitoring | DSL script |
| 6. Monitor/Close | Wait for exit | `account_get_portfolio` |
| 7. Celebrate | Show results, next steps | â€” |

### Skip Option

User can say "skip tutorial" â†’ state = `READY` with `firstTrade.skipped: true`

---

## Balance Monitoring

### Check Triggers

| Trigger | Action |
|---------|--------|
| State is `UNFUNDED` + any user message | Check balance |
| User asks about balance/wallet | Check balance |
| Every 5 minutes while `UNFUNDED` | Background check |
| Before any trade operation | Verify sufficient funds |

### State Transitions

```
UNFUNDED + balance > 0 â†’ AWAITING_FIRST_TRADE
AWAITING_FIRST_TRADE + balance == 0 â†’ UNFUNDED
READY + balance == 0 â†’ UNFUNDED
```

---

## Error Handling & Recovery

### Onboarding Errors

| Error | Cause | Recovery |
|-------|-------|----------|
| Network timeout | API unreachable | Retry once; if fails, state=FAILED |
| Invalid wallet | Malformed address | Ask user to re-enter |
| Invalid referral | Code doesn't exist | Proceed without |
| User already exists | Account linked | Direct to senpi.ai/apikey (Path B flow) |
| Wallet gen failed | Node.js issue | Try fallbacks; ask for wallet/Telegram |
| MCP config failed | mcporter error | state=FAILED; offer manual instructions |

### Partial State Recovery

On startup with `state=ONBOARDING`:
1. Read `onboarding.step`
2. Resume from next step (don't re-collect completed data)

---

## File Structure

### Storage Layout

```
$SENPI_STATE_DIR/                         # Senpi state (default $HOME/.senpi)
â”œâ”€â”€ credentials.json                      # API key, user ID (chmod 600)
â”œâ”€â”€ wallet.json                           # Private key if generated (chmod 600)
â”œâ”€â”€ state.json                            # Onboarding + first trade state
â””â”€â”€ skills/
    â”œâ”€â”€ _manifest.json                    # Cached skills catalog
    â”œâ”€â”€ senpi-onboard/                    # Bootstrap skill
    â”‚   â””â”€â”€ SKILL.md
    â”œâ”€â”€ dsl-dynamic-stop-loss/
    â”‚   â”œâ”€â”€ SKILL.md
    â”‚   â””â”€â”€ scripts/
    â”‚       â””â”€â”€ dsl.py
    â””â”€â”€ {other-installed-skills}/

$OPENCLAW_WORKSPACE_DIR                   # OpenClaw/Hyperclaw workspace
â”œâ”€â”€ config/
â”‚   â””â”€â”€ mcporter.json                     # MCP server configurations
â””â”€â”€ ...                                   # Other workspace files
```

### Template Repository

```
hyperclaw-template/
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ railway.json
â”œâ”€â”€ railway.toml                          # Volume mount config
â”œâ”€â”€ package.json
â”œâ”€â”€ README.md
â”‚
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ ONBOARDING_ARCHITECTURE.md
â”‚
â”œâ”€â”€ skills/
â”‚   â””â”€â”€ senpi-onboard/
â”‚       â””â”€â”€ SKILL.md                      # Pre-bundled bootstrap skill
â”‚
â””â”€â”€ config/
    â””â”€â”€ manifest.json                     # Bundled manifest (fallback)
```

---

## Railway Deployment

### railway.toml

```toml
[build]
builder = "dockerfile"
dockerfilePath = "Dockerfile"

[deploy]
startCommand = "npm start"
healthcheckPath = "/health"
healthcheckTimeout = 30
restartPolicyType = "on_failure"

[[mounts]]
source = "senpi-config"
destination = "/root/.senpi"   # or set SENPI_STATE_DIR to this path

[[mounts]]
source = "openclaw-workspace"
destination = "/root/.openclaw/workspace"
```

### Environment Variables

| Variable | Required | Default | Description |
|----------|----------|---------|-------------|
| `HYPERCLAW_TEMPLATE` | No | `true` | Indicates template deployment |
| `SENPI_MCP_ENDPOINT` | No | `https://mcp.prod.senpi.ai` | MCP server URL |
| `SKILLS_MANIFEST_URL` | No | GitHub raw URL | Skills catalog URL |
| `REFERRAL_CODE` | No | (empty) | Pre-filled referral for new users |

---

## Agent System Prompt

Add to the Hyperclaw agent's system prompt:

```markdown
## Senpi Onboarding & First Trade Guide

You are connected to Senpi, a trading platform on Hyperliquid. Before processing requests, verify the user's state.

### Startup Check (REQUIRED on every message)

Read `$SENPI_STATE_DIR/state.json` and route based on state:

| State | Action |
|-------|--------|
| File missing | FRESH â†’ Detect path, start onboarding |
| `ONBOARDING` | Resume from `onboarding.step` |
| `UNFUNDED` | Show funding reminder, allow skill browsing |
| `AWAITING_FIRST_TRADE` | Prompt to start first trade tutorial |
| `FAILED` | Offer retry or manual fallback |
| `READY` | Process message normally |

### Path Detection

- **Template path**: No credentials + `HYPERCLAW_TEMPLATE=true` â†’ Full onboarding
- **skill.md path**: User sends SKILL.md or says "setup senpi" â†’ Check existing account

### Onboarding Flow

Follow `$SENPI_STATE_DIR/skills/senpi-onboard/SKILL.md` for detailed steps:
1. Collect identity (Telegram / Wallet / Generate)
2. Call CreateAgentStubAccount API (or collect existing API key)
3. Save credentials to `$SENPI_STATE_DIR/credentials.json`
4. Configure MCP via mcporter (persist to `$OPENCLAW_WORKSPACE_DIR/config/mcporter.json`)
5. Show skills catalog

### First Trade Guide

When state is `AWAITING_FIRST_TRADE`:
1. Offer to start tutorial: "Ready for your first trade?"
2. Discovery â€” Show smart money activity
3. Skill install â€” Install DSL if not present
4. Position open â€” Small test position ($50, 3x leverage)
5. DSL setup â€” Activate protection
6. Monitor â€” Let user watch or wait for close
7. Celebrate â€” Congratulate and suggest next steps

Allow skip: "skip tutorial" â†’ state=READY

### Skills Catalog

When user asks about skills:
1. Fetch manifest (cache 24h at `$SENPI_STATE_DIR/skills/_manifest.json`)
2. Display with emoji, name, description, minBudget, difficulty
3. Mark installed skills
4. Recommend beginner skills for new users

Install: Download all files to `$SENPI_STATE_DIR/skills/{id}/`

### Balance Monitoring

When state is `UNFUNDED`:
- Check balance on every message
- Prepend funding reminder to responses
- Transition to `AWAITING_FIRST_TRADE` when balance > 0

### File Paths

- Credentials: `$SENPI_STATE_DIR/credentials.json`
- State: `$SENPI_STATE_DIR/state.json`
- Wallet (if generated): `$SENPI_STATE_DIR/wallet.json`
- Skills: `$SENPI_STATE_DIR/skills/{skill-id}/`
- MCP config: `$OPENCLAW_WORKSPACE_DIR/config/mcporter.json`
```

---

## Summary: Complete User Journey

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        COMPLETE USER JOURNEY                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TEMPLATE PATH                              SKILL.MD PATH
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                               â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Deploy on Railway                       1. Download SKILL.md
         â”‚                                          â”‚
         â–¼                                          â–¼
2. Open app, send message                  2. Send to Telegram agent
         â”‚                                          â”‚
         â–¼                                          â–¼
3. Agent detects FRESH state               3. Agent detects skill upload
         â”‚                                          â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
              4. Check for existing account
                  â”‚                    â”‚
                  â–¼                    â–¼
            [NEW ACCOUNT]        [EXISTING ACCOUNT]
            Collect identity     Get API key from user
                  â”‚                    â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
              5. Save credentials + configure MCP
                           â”‚
                           â–¼
              6. State = UNFUNDED
                 Show wallet address + skills catalog
                           â”‚
                           â–¼
              7. [USER FUNDS WALLET]
                           â”‚
                           â–¼
              8. State = AWAITING_FIRST_TRADE
                 Prompt: "Ready for your first trade?"
                           â”‚
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚                       â”‚
               â–¼                       â–¼
        [YES, TUTORIAL]         [SKIP TUTORIAL]
               â”‚                       â”‚
               â–¼                       â”‚
        9. Discovery                   â”‚
        10. Install DSL                â”‚
        11. Open position              â”‚
        12. Activate DSL               â”‚
        13. Monitor/Close              â”‚
        14. Celebrate! ðŸŽ‰              â”‚
               â”‚                       â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
              15. State = READY
                  Full access to all features
                           â”‚
                           â–¼
              16. Trade independently
                  Install more skills
                  Go autonomous with WOLF
```

---

## Changelog

| Version | Date | Changes |
|---------|------|---------|
| 1.0.0 | 2025-02-26 | Initial architecture |
| 1.1.0 | 2025-02-26 | Added First Trade Guide, dual onboarding paths |
| 1.2.0 | 2025-02-26 | Changed mcporter.json to $OPENCLAW_WORKSPACE_DIR/config/, template workspace to $OPENCLAW_WORKSPACE_DIR/ |
